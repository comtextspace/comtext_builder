# Структура файлов

Описание структуры файлов для генерации сайта.

## comtext.yml

В корне репозитория должен находиться файл `comtext.yml`. Его структура:

```yaml
vuepress:
  title: "Название сайта"
  base: "/"
  revisionmeProjectId: "project-id"  # опционально
  revisionmeFloatingBtn: "1"         # опционально
  revisionmeContextWidget: "..."     # опционально
  markdown_toc_level: [2, 3]         # опционально

pages:
  - index.md
  - about.md
  # Можно указать каталог - будут обработаны все .md файлы рекурсивно
  - pages/

books:
  - content/book-1.md
  - content/book-2.md
  # Можно указать каталог - будут обработаны все .md файлы рекурсивно
  - content/books/
```

### Раздел vuepress

В разделе `vuepress` настраивается конфигурация сайта:

* `title` — заголовок сайта (обязательно)
* `base` — дополнительный путь до сайта, если он будет размещаться не в корне домена (по умолчанию `"/"`)
* `revisionmeProjectId` — идентификатор проекта RevisionMe (опционально)
* `revisionmeFloatingBtn` — включение плавающей кнопки RevisionMe (опционально)
* `revisionmeContextWidget` — настройка виджета контекста RevisionMe (опционально)
* `markdown_toc_level` — уровни заголовков для автоматического оглавления, массив чисел (опционально)

### Раздел pages

Раздел `pages` содержит список страниц сайта. Можно указать:

* **Отдельный файл**: `- index.md` — файл будет скопирован на сайт
* **Каталог**: `- pages/` — все `.md` файлы из каталога и всех подкаталогов будут обработаны рекурсивно

Файлы страниц обрабатываются с заменой специальных конструкций `[[files имя]]` на ссылки для скачивания.

### Раздел books

Раздел `books` содержит список книг. Для каждой книги можно указать:

* **Отдельный файл**: `- content/book-1.md` — относительный путь к файлу книги в формате [Comtext](https://research.comtext.space/format-comtext.html) с расширением `.md`
* **Каталог**: `- content/books/` — все `.md` файлы из каталога и всех подкаталогов будут обработаны рекурсивно

Для каждой книги автоматически генерируются:
* Страница на сайте (`.md`)
* Файл в формате Comtext (`.ct`)
* Архив с книгой и изображениями (`.ct.zip`)
* Экспорт в FB2 (`.fb2`)
* Экспорт в EPUB (`.epub`)

Все файлы доступны для скачивания в каталоге `/files/` на сайте.

## Изображения

Изображения автоматически переносятся на сайт из:

* каталога `img` в том же каталоге где находится файл книги;
* каталога `img` в корне репозитория.

Названия файлов с изображениями для книг должно совпадать с названием файла книги с дополнительным постфиксом.

Пример для книги в файле `рубин-очерки-по-теории-стоимости-маркса.md`:

```markdown
![Диаграмма 1](/img/рубин-очерки-по-теории-стоимости-маркса-1.png)

![Диаграмма 2](/img/рубин-очерки-по-теории-стоимости-маркса-2.png)
```

Каталог `img` в корне репозитория можно использовать для хранения изображений для страниц сайта.

## Форматы экспорта

Для каждой книги автоматически создаются следующие форматы:

* **Comtext (`.ct`)** — исходный формат книги
* **Comtext ZIP (`.ct.zip`)** — архив с книгой и связанными изображениями
* **FB2 (`.fb2`)** — формат FictionBook 2.0 для электронных книг
* **EPUB (`.epub`)** — формат EPUB 3 для электронных книг

Все файлы доступны для скачивания в каталоге `/files/` на сайте.

## OPDS каталог

Автоматически генерируется OPDS-каталог (`catalog.opds`) со всеми книгами, доступный по адресу `/catalog.opds`. Каталог содержит метаданные книг (название, автор) и ссылки на скачивание в формате FB2.

## Файлы для скачивания

В каталоге `files/` в корне репозитория можно разместить дополнительные файлы, которые будут скопированы на сайт в каталог `/files/`.

## Пример структуры репозитория

```
репозиторий/
├── comtext.yml
├── index.md
├── img/
│   └── logo.png
├── files/
│   └── additional-file.pdf
└── content/
    ├── img/
    │   ├── рубин-история-экономической-мысли-1.png
    │   └── рубин-очерки-по-теории-стоимости-маркса-1.png
    ├── рубин-история-экономической-мысли.md
    ├── рубин-очерки-по-теории-денег-маркса.md
    └── books/
        ├── рубин-очерки-по-теории-стоимости-маркса.md
        └── other/
            └── другая-книга.md
```

### Пример comtext.yml

```yaml
vuepress:
  title: "Библиотека экономической мысли"
  base: "/"
  markdown_toc_level: [2, 3]

pages:
  - index.md

books:
  - content/  # Обработает все .md файлы из content/ и подкаталогов
```

В этом примере все файлы из каталога `content/` и его подкаталогов (включая `content/books/` и `content/books/other/`) будут автоматически обработаны как книги.